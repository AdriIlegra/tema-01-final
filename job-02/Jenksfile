pipeline {
    agent any

     environment {
            CI = 'true'
            ARTIFACTORY_SERVER_ID = 'Calculadora' // Nome do servidor de Artifactory configurado no Jenkins
        }

    stages {
        stage('Checkout Code') {
            steps {
                // Passo para verificar o código do repositório do GitHub
                checkout scm
            }
        }
        stage('Build Docker Image') {
            steps {

                // Passo para construir a imagem Docker

                script {
                    def imageName = "calculadora"
                    def image = docker.build(imageName)
                }
            }
        }
        stage('Test Docker Image') {
            steps {
                // Passo para testar a imagem Docker
                script {
                    def imageName = "nodejs-app"
                    def image = docker.build(imageName)
                    image.inside {
                        sh 'npm install'
                        sh 'npm test'
                    }
                }

            }
        }
        stage('Push Docker Image') {
            steps {

                    // Tag e envie a imagem Docker para o Docker Hub
                    sh "docker tag $imageName:latest $DOCKER_USERNAME/$imageName:latest"
                    sh "docker tag $imageName:latest $DOCKER_USERNAME/$imageName:1.0"
                    sh "docker push $DOCKER_USERNAME/$imageName:latest"
                    sh "docker push $DOCKER_USERNAME/$imageName:1.0"
                }
            }
        }
    }

    post {
        success {

            echo "Pipeline concluída com sucesso!"
        }
    }
}
    }